## ä¸€ã€é€’å½’ç»„ä»¶(å¤ç”¨è‡ªèº«)

**åœ¨çˆ¶ç»„ä»¶é…ç½®æ•°æ®ç»“æ„ï¼Œæ•°ç»„å¯¹è±¡æ ¼å¼ï¼Œä¼ ç»™å­ç»„ä»¶**

```js
type TreeList = {
  name: string,
  icon?: string,
  chiildren?: TreeList[] | []
}

const data = reactive<TreeList[]>([
  {
    name: "no.1",
    children: [
      {
        name: "no.1-1",
        children: [
          {
            name: "no.1-1-1",
          },
        ],
      },
    ],
  },
  {
    name: "no.2",
    children: [
      {
        name: "no.2-1",
      },
    ],
  },
  {
    name: "no.3",
  },
]);
```

**å­ç»„ä»¶æ¥æ”¶å€¼**

> `TreeItem` å…¶å®å°±æ˜¯å½“å‰ç»„ä»¶,é€šè¿‡import æŠŠè‡ªèº«åˆå¼•å…¥äº†ä¸€éï¼ˆæˆ–è€…é€šè¿‡å¯¼å‡ºè‡ªèº«ç»„ä»¶åï¼‰,å¦‚æœä»–æ²¡æœ‰children äº†å°±ç»“æŸã€‚

```vue
<template>
<div style="margin-left:10px;" class="tree">
  <div :key="index" v-for="(item,index) in data">
    <div @click.stop='clickItem(item)'>{{item.name}}
  </div>
    <TreeItem @on-click='clickItem' v-if='item?.children?.length' :data="item.children"></TreeItem>
  </div>
  </div>
</template>
<script lang="ts" setup>
  type TreeList = {
    name: string;
    icon?: string;
    children?: TreeList[] | [];
  };

  type Props<T> = {
    data?: T[] | [];
  };

  defineProps<Props<TreeList>>(); 
</script>
<script>
export default {
  name: "TreeItem" // å¯¹å¤–æš´éœ²ä¸€ä¸ªname
}
</script>
```

## äºŒã€åŠ¨æ€ç»„ä»¶ï¼ˆ`is`å±æ€§ï¼‰

> åŠ¨æ€ç»„ä»¶é€šè¿‡v-bindç»‘å®šï¼Œè®©å¤šä¸ªç»„ä»¶ä½¿ç”¨åŒä¸€ä¸ªæŒ‚è½½ç‚¹(`component`æ ‡ç­¾)ï¼Œå¹¶åŠ¨æ€åˆ‡æ¢ï¼Œè¿™å°±æ˜¯åŠ¨æ€ç»„ä»¶

**é€šè¿‡is åˆ‡æ¢ Aã€B ç»„ä»¶:**

```js
import A from './A.vue'
import B from './B.vue'

 <component :is="A"></component>
```

### ä½¿ç”¨åœºæ™¯

> tabæ ‡ç­¾é¡µåˆ‡æ¢å±…å¤š

### æ³¨æ„äº‹é¡¹

1. åœ¨Vue2 çš„æ—¶å€™`is` æ˜¯é€šè¿‡**ç»„ä»¶åç§°**åˆ‡æ¢çš„ï¼Œåœ¨Vue3 setup æ˜¯é€šè¿‡**ç»„ä»¶å®ä¾‹**åˆ‡æ¢çš„

2. å¦‚æœä½ æŠŠç»„ä»¶å®ä¾‹æ”¾åˆ°Reactive Vueä¼šç»™ä½ ä¸€ä¸ªè­¦å‘Š<code>runtime-core.esm-bundler.js:38 [Vue warn]: Vue received a Component which was made a reactive object. This can lead to unnecessary performance overhead, and should be avoided by marking the component with `markRaw` or using `shallowRef` instead of `ref`. 
   Component that was made reactive: </code>

   è¿™æ˜¯å› ä¸ºreactive ä¼šè¿›è¡Œproxy ä»£ç†ï¼Œè€Œæˆ‘ä»¬ç»„ä»¶ä»£ç†ä¹‹åæ¯«æ— ç”¨å¤„ï¼ŒèŠ‚çœæ€§èƒ½å¼€é”€æ¨èæˆ‘ä»¬ä½¿ç”¨`shallowRef` æˆ–è€…  `markRaw` è·³è¿‡ proxy ä»£ç†
   
   ```vue
   <script lang="ts" setup>
   import { reactive, markRaw } from 'vue'
   import A from './components/a.vue'
   import B from './components/b.vue'
   
   type Tabs = {
     name: string
     comName: any
   }
   const data = reactive<Tabs[]>([
     {
       name: 'a',
       comName: markRaw(A)
     },
     {
       name: 'b',
       comName: markRaw(B)
     }
   ])
   </script>
   ```

## ä¸‰ã€å¼‚æ­¥ç»„ä»¶(å‡å°‘ç™½å±)

> ä½¿ç”¨æ–¹å¼ï¼šéœ€è¦ç»“åˆ`suspense`ç»„ä»¶ã€`defineAsyncComponent`ã€`import`æ–¹æ³•ä½¿ç”¨
>
> ä½œç”¨ï¼šç¨‹åºä¼˜åŒ–ã€‚å°†åº”ç”¨åˆ†å‰²æˆå°ä¸€äº›çš„ä»£ç å—ï¼Œå¹¶ä¸”å‡å°‘ä¸»åŒ…çš„ä½“ç§¯ï¼Œå‡å°‘å±å¹•ç™½å±æ—¶é—´ã€‚(buildæ‰“åŒ…æ—¶ä¼šå°†å¼‚æ­¥ç»„ä»¶å•ç‹¬æ‰“åŒ…)

### é¡¶å±‚ `await`

`<script setup> `ä¸­å¯ä»¥ä½¿ç”¨é¡¶å±‚ awaitã€‚ç»“æœä»£ç ä¼šè¢«ç¼–è¯‘æˆ` async setup()`

```xml
<template>
    <div>
        {{ data}}
    </div>
</template>
<script lang="ts" setup>
const request = () => {
    return new Promise(resolve => {
        setTimeout(() => {
            resolve(11111)
        }, 3000)
    })
}
const data = await request();
</script>
```

çˆ¶ç»„ä»¶å¼•ç”¨å­ç»„ä»¶ é€šè¿‡defineAsyncComponentåŠ è½½å¼‚æ­¥é…åˆimport å‡½æ•°æ¨¡å¼ä¾¿å¯ä»¥åˆ†åŒ…

```vue
<script setup lang="ts">
import { defineAsyncComponent } from 'vue'

const Child = defineAsyncComponent(() => import('child.vue'))
</script>
```

### suspense

```vue
<template>
    <suspense>
      <template #default>
        <Child />
      </template>
      <template #fallback>
        <div>
          loading....
        </div>
      </template>
    </suspense>
</template>
```

## å››ã€`keep-alive`ç¼“å­˜ç»„ä»¶

> æœ‰æ—¶å€™æˆ‘ä»¬ä¸å¸Œæœ›ç»„ä»¶è¢«é‡æ–°æ¸²æŸ“å½±å“ä½¿ç”¨ä½“éªŒï¼›æˆ–è€…å¤„äºæ€§èƒ½è€ƒè™‘ï¼Œé¿å…å¤šæ¬¡é‡å¤æ¸²æŸ“é™ä½æ€§èƒ½ã€‚è€Œæ˜¯å¸Œæœ›ç»„ä»¶å¯ä»¥ç¼“å­˜ä¸‹æ¥,ç»´æŒå½“å‰çš„çŠ¶æ€ã€‚è¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°`keep-alive`ç»„ä»¶ã€‚

ä½¿ç”¨`keep-alive`åç»„ä»¶çš„ ç”Ÿå‘½å‘¨æœŸçš„å˜åŒ–å¦‚ä¸‹ï¼š

1. åˆæ¬¡è¿›å…¥æ—¶ï¼šå…ˆ `onMounted`, å†`onActivated`

2. é€€å‡ºåè§¦å‘ `onDeactivated`

3. å†æ¬¡è¿›å…¥ï¼šåªä¼šè§¦å‘ `onActivated`

   å› æ­¤ï¼Œäº‹ä»¶æŒ‚è½½çš„æ–¹æ³•ç­‰ å’Œ åªæ‰§è¡Œä¸€æ¬¡çš„æ”¾åœ¨ `onMounted`ä¸­ï¼›ç»„ä»¶æ¯æ¬¡è¿›å»æ‰§è¡Œçš„æ–¹æ³•æ”¾åœ¨ onActivatedä¸­

```vue
<!-- åŸºæœ¬ -->
<keep-alive>
  <component :is="view"></component>
</keep-alive>
 
<!-- å¤šä¸ªæ¡ä»¶åˆ¤æ–­çš„å­ç»„ä»¶ -->
<keep-alive>
  <comp-a v-if="a > 1"></comp-a>
  <comp-b v-else></comp-b>
</keep-alive>
 
<!-- å’Œ `<transition>` ä¸€èµ·ä½¿ç”¨ -->
<transition>
  <keep-alive>
    <component :is="view"></component>
  </keep-alive>
</transition>
```

### `include` ã€`exclude`å’Œ`max`

> `include`: è®¾ç½®`keep-alive`**ç¼“å­˜**å“ªäº›ç»„ä»¶ï¼Œå¯ä»¥ç”¨é€—å·åˆ†éš”å­—ç¬¦ä¸²ã€æ­£åˆ™è¡¨è¾¾å¼æˆ–ä¸€ä¸ªæ•°ç»„æ¥è¡¨ç¤º
>
> `exclude`: è®¾ç½®`keep-alive`**ä¸ç¼“å­˜**å“ªäº›ç»„ä»¶ï¼Œå¯ä»¥ç”¨é€—å·åˆ†éš”å­—ç¬¦ä¸²ã€æ­£åˆ™è¡¨è¾¾å¼æˆ–ä¸€ä¸ªæ•°ç»„æ¥è¡¨ç¤º
>
> `max`: è®¾ç½®`keep-alive`ç¼“å­˜ç»„ä»¶çš„æ•°é‡

```vue
<keep-alive :include="['A']" :exclude="" :max="5">
	<A></A>
  <B></B>
</keep-alive>
```

```vue
# ç»„ä»¶A.vue
<script>
export default {
  name: 'A'
}
</script>

# ç»„ä»¶B.vue
<script>
export default {
  name: 'B'
}
</script>
```

## äº”ã€`transition`åŠ¨ç”»ç»„ä»¶

> åœ¨ä¸‹åˆ—æƒ…å½¢ä¸­ï¼Œå¯ä»¥ç»™ä»»ä½•å…ƒç´ å’Œç»„ä»¶æ·»åŠ è¿›å…¥/ç¦»å¼€è¿‡æ¸¡:
>
> - æ¡ä»¶æ¸²æŸ“ (ä½¿ç”¨ `v-if`)
> - æ¡ä»¶å±•ç¤º (ä½¿ç”¨ `v-show`)
> - åŠ¨æ€ç»„ä»¶
> - ç»„ä»¶æ ¹èŠ‚ç‚¹

### 1.åŸºæœ¬ä½¿ç”¨

**è‡ªå®šä¹‰ transition è¿‡æ¸¡æ•ˆæœï¼Œä½ éœ€è¦å¯¹`transition`ç»„ä»¶çš„`name`å±æ€§è‡ªå®šä¹‰ï¼Œå¹¶åœ¨cssä¸­å†™å…¥å¯¹åº”çš„æ ·å¼**ã€‚åœ¨è¿›å…¥/ç¦»å¼€çš„è¿‡æ¸¡ä¸­ï¼Œä¼šæœ‰ 6 ä¸ª class åˆ‡æ¢

```vue
<template>
       <button @click='flag = !flag'>åˆ‡æ¢</button>
       <transition name='fade'>
         <div v-if='flag' class="box"></div>
       </transition>
</template>
<style>
//å¼€å§‹è¿‡æ¸¡
.fade-enter-from{
   background:red;
   width:0px;
   height:0px;
   transform:rotate(360deg)
}
//å¼€å§‹è¿‡æ¸¡äº†
.fade-enter-active{
  transition: all 2.5s linear;
}
//è¿‡æ¸¡å®Œæˆ
.fade-enter-to{
   background:yellow;
   width:200px;
   height:200px;
}
//ç¦»å¼€çš„è¿‡æ¸¡
.fade-leave-from{
  width:200px;
  height:200px;
  transform:rotate(360deg)
}
//ç¦»å¼€ä¸­è¿‡æ¸¡
.fade-leave-active{
  transition: all 1s linear;
}
//ç¦»å¼€å®Œæˆ
.fade-leave-to{
  width:0px;
   height:0px;
}
</style>
```

### 2.è‡ªå®šä¹‰è¿‡æ¸¡ class ç±»åä¸è¿‡æ¸¡æ—¶é—´

> ä½œç”¨ï¼šç»“åˆç¬¬ä¸‰æ–¹åŠ¨ç”»åº“ä½¿ç”¨

#### è®¾ç½®è¿‡æ¸¡ class ç±»å

ä¸€å…±å¯ä»¥è®¾ç½®6ä¸ªç±»åï¼š

- `enter-from-class`
- `enter-active-class`
- `enter-to-class`
- `leave-from-class`
- `leave-active-class`
- `leave-to-class`

```vue
<template>
        <transition
            leave-active-class="animate__animated animate__bounceInLeft"
            enter-active-class="animate__animated animate__bounceInRight"
        >
            <div v-if="flag" class="box"></div>
        </transition>
</template>
```

#### è®¾ç½®è¿‡æ¸¡æ—¶é—´

```vue
<transition :duration="1000">...</transition>
 
<!-- åˆ†åˆ«æŒ‡å®šè¿›å…¥å’Œç¦»å¼€çš„æŒç»­æ—¶é—´ -->
<transition :duration="{ enter: 500, leave: 800 }">...</transition>
```

### 3. `transition`ç”Ÿå‘½å‘¨æœŸé’©å­

> åŠ¨ç”»å®ç°è¿‡ç¨‹ä¸­å‘å¤–æŠ›å‡ºçš„äº‹ä»¶

å¯ä»¥ç»“åˆ`gsap` åŠ¨ç”»åº“ä½¿ç”¨ [GreenSock](https://greensock.com/)

```vue
<template>
  <transition
              @before-enter="beforeEnter"  <!--å¯¹åº”enter-from-->
              @enter="enter" <!-- å¯¹åº”enter-active-->
              @after-enter="afterEnter" <!-- å¯¹åº”enter-to-->
              @enter-cancelled="enterCancelled" <!-- æ˜¾ç¤ºè¿‡æ¸¡æ‰“æ–­-->
              @before-leave="beforeLeave" <!-- å¯¹åº”leave-from-->
              @leave="leave" <!-- å¯¹åº”enter-active-->
              @after-leave="afterLeave" <!-- å¯¹åº”leave-to-->
              @leave-cancelled="leaveCancelled" <!-- ç¦»å¼€è¿‡æ¸¡æ‰“æ–­-->
              >
  ...
  </transition>
</template>
<script lang="ts" setup>
// import gsap from "gsap"

const beforeEnter = (el: Element) => {
    console.log('è¿›å…¥ä¹‹å‰from', el);
}
const Enter = (el: Element,done:Function) => {
    console.log('è¿‡åº¦æ›²çº¿');
    setTimeout(()=>{
       done()
    },3000)
}
const AfterEnter = (el: Element) => {
    console.log('to');
}
</script>
```

**æ³¨æ„ğŸ“¢ï¼š**å½“åªç”¨ JavaScript è¿‡æ¸¡çš„æ—¶å€™ï¼Œåœ¨ **`enter` å’Œ `leave` é’©å­ä¸­å¿…é¡»ä½¿ç”¨ `done` è¿›è¡Œå›è°ƒ**

### 4.`appear` é¡µé¢åŠ è½½å®Œç«‹åˆ»æ˜¾ç¤ºåŠ¨ç”»

> é€šè¿‡è¿™ä¸ªå±æ€§å¯ä»¥è®¾ç½®åˆå§‹èŠ‚ç‚¹è¿‡æ¸¡ï¼Œå°±æ˜¯é¡µé¢åŠ è½½å®Œæˆå°±å¼€å§‹åŠ¨ç”»ï¼Œå¯¹åº”ä¸‰ä¸ªçŠ¶æ€

```vue
<template>
	<transition
              appear
              appear-active-class="from"
							appear-from-class="active"
							appear-to-class="to"
              >
  	<div v-if='flag' class="box"></div>
  </transition>
</template>
<style>
  .box {
    width: 200px;
    height: 200px;
  }
  .from {
    width: 0;
    height: 0;
  }
  .active {
    transition: all .3s ease
  }
  .to {
    width: 200px;
    height: 200px;
  }
</style>
```

## å…­ã€`transition-group` åŠ¨ç”»ç»„ä»¶

### ç‰¹ç‚¹

- é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¸ä¼šæ¸²æŸ“ä¸€ä¸ªåŒ…è£¹å…ƒç´ ï¼Œä½†æ˜¯ä½ å¯ä»¥é€šè¿‡ `tag` attribute æŒ‡å®šæ¸²æŸ“ä¸€ä¸ªå…ƒç´ ã€‚
- [è¿‡æ¸¡æ¨¡å¼](https://v3.cn.vuejs.org/guide/transitions-enterleave.html#è¿‡æ¸¡æ¨¡å¼)ä¸å¯ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å†ç›¸äº’åˆ‡æ¢ç‰¹æœ‰çš„å…ƒç´ ã€‚
- å†…éƒ¨å…ƒç´ **æ€»æ˜¯éœ€è¦**æä¾›å”¯ä¸€çš„ `key` attribute å€¼ã€‚
- CSS è¿‡æ¸¡çš„ç±»å°†ä¼šåº”ç”¨åœ¨å†…éƒ¨çš„å…ƒç´ ä¸­ï¼Œè€Œä¸æ˜¯è¿™ä¸ªç»„/å®¹å™¨æœ¬èº«ã€‚

`transition-group`ç»„ä»¶å…·æœ‰ä¸`transition`ç»„ä»¶ç›¸åŒçš„ **ç”Ÿå‘½å‘¨æœŸé’©å­** å’Œ **è¿‡æ¸¡classç±»å**ï¼š

```vue
    <transition-group 
      tag="ul" 
      @before-enter="beforeEnter" 
      <!-- å¯¹åº”enter-from -->
      @enter="enter"
      <!-- å¯¹åº”enter-active-->
      @after-enter="afterEnter"
      <!-- å¯¹åº”enter-to-->
      @enter-cancelled="enterCancelled"
      <!-- æ˜¾ç¤ºè¿‡æ¸¡æ‰“æ–­-->
      @before-leave="beforeLeave"
      <!-- å¯¹åº”leave-from-->
      @leave="leave"
      <!-- å¯¹åº”enter-active-->
      @after-leave="afterLeave"
      <!-- å¯¹åº”leave-to-->
      @leave-cancelled="leaveCancelled"
      <!-- ç¦»å¼€è¿‡æ¸¡æ‰“æ–­-->

      leave-active-class="animate__animated animate__bounceInLeft"
      enter-active-class="animate__animated animate__bounceInRight"
      >
      <li v-for="item in items" :key="item.id" :style="{color: item.color}">
        {{item.text}}
      </li>
    </transition-group>
```

## åˆ—è¡¨çš„ç§»åŠ¨è¿‡æ¸¡

`transition-group`ç»„ä»¶è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šä¹‹å¤„ã€‚é™¤äº†è¿›å…¥å’Œç¦»å¼€ï¼Œå®ƒè¿˜èƒ½ä¸ºå…ƒç´ å®šä½ä½ç½®çš„æ”¹å˜æ·»åŠ åŠ¨ç”»ã€‚åªéœ€äº†è§£æ–°å¢çš„ v-move ç±»å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–°åŠŸèƒ½ï¼Œå®ƒä¼šåº”ç”¨åœ¨å…ƒç´ æ”¹å˜å®šä½çš„è¿‡ç¨‹ä¸­ã€‚åƒä¹‹å‰çš„ç±»åä¸€æ ·ï¼Œå®ƒçš„å‰ç¼€å¯ä»¥é€šè¿‡ `name` attribute æ¥è‡ªå®šä¹‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ `move-class` attribute æ‰‹åŠ¨è®¾ç½®

```vue
<template>
    <div>
        <button @click="shuffle">Shuffle</button>
        <transition-group class="wraps" name="mmm" tag="ul">
            <li class="cell" v-for="item in items" :key="item.id">{{ item.number }}</li>
        </transition-group>
    </div>
</template>
  
<script setup  lang='ts'>
import _ from 'lodash'
import { ref } from 'vue'

// è¿™é‡Œæ˜¯ç›´æ¥æ›¿æ¢æ•°ç»„ï¼Œç”¨reactiveä¼šä¸¢å¤±å“åº”
let items = ref(Array.apply(null, { length: 81 } as number[]).map((_, index) => {
    return {
        id: index,
        number: (index % 9) + 1
    }
}))
const shuffle = () => {
    items.value = _.shuffle(items.value)
}
</script>
  
<style scoped lang="less">
.wraps {
    display: flex;
    flex-wrap: wrap;
    width: calc(25px * 10 + 9px);
    .cell {
        width: 25px;
        height: 25px;
        border: 1px solid #ccc;
        list-style-type: none;
        display: flex;
        justify-content: center;
        align-items: center;
    }
}
 
.mmm-move {
    transition: transform 0.8s ease;
}
</style>
```

### çŠ¶æ€è¿‡æ¸¡

> å¯ä»¥ç»™**æ•°å­—**ã€ **Svg**ã€ **èƒŒæ™¯é¢œè‰²**ç­‰æ·»åŠ è¿‡åº¦åŠ¨ç”»

```vue
<template>
    <div>
        <input step="20" v-model="num.current" type="number" />
        <div>{{ num.tweenedNumber.toFixed(0) }}</div>
    </div>
</template>
    
<script setup lang='ts'>
import { reactive, watch } from 'vue'
import gsap from 'gsap'
const num = reactive({
    tweenedNumber: 0,
    current:0
})
 
watch(()=>num.current, (newVal) => {
    gsap.to(num, {
        duration: 1,
        tweenedNumber: newVal
    })
})
 
</script>
```

