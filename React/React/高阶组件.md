## ä¸€ã€ç»„ä»¶

* `React.Component` 
*  `React.PureComponent`
* `React.memo`ï¼šæŠŠç»„ä»¶å®šä¹‰ä¸ºå¯è¢«åŒ…è£…çš„å‡½æ•°
* `React.Fragment`ï¼šæ˜¯ä¸€ä¸ªç”¨äºå‡å°‘ä¸å¿…è¦åµŒå¥—çš„ç»„ä»¶

### 1.`React.Component`

### 2.`React.PureComponent`

> `React.PureComponent` ä¸ `React.Component` å¾ˆç›¸ä¼¼ã€‚ä¸¤è€…çš„åŒºåˆ«åœ¨äº `React.Component` å¹¶æœªå®ç° `shouldComponentUpdate()`ï¼Œè€Œ `React.PureComponent` ä¸­ä»¥æµ…å±‚å¯¹æ¯” **prop** å’Œ **state** çš„æ–¹å¼æ¥å®ç°äº†è¯¥å‡½æ•°ã€‚

#### ä½¿ç”¨åœºæ™¯

å¦‚æœèµ‹äºˆ React ç»„ä»¶ç›¸åŒçš„ **props** å’Œ **state**ï¼Œ`render()` å‡½æ•°ä¼šæ¸²æŸ“ç›¸åŒçš„å†…å®¹ï¼Œé‚£ä¹ˆåœ¨æŸäº›æƒ…å†µä¸‹ä½¿ç”¨ `React.PureComponent` å¯æé«˜æ€§èƒ½ã€‚

#### æ³¨æ„ç‚¹ğŸ“¢

> `React.PureComponent` ä¸­çš„ `shouldComponentUpdate()` ä»…ä½œå¯¹è±¡çš„æµ…å±‚æ¯”è¾ƒã€‚
>
> å¦‚æœå¯¹è±¡ä¸­åŒ…å«å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œåˆ™æœ‰å¯èƒ½å› ä¸ºæ— æ³•æ£€æŸ¥æ·±å±‚çš„å·®åˆ«ï¼Œäº§ç”Ÿé”™è¯¯çš„æ¯”å¯¹ç»“æœã€‚ä»…åœ¨ä½ çš„ **props** å’Œ **state** è¾ƒä¸ºç®€å•æ—¶ï¼Œæ‰ä½¿ç”¨ `React.PureComponent`ï¼Œæˆ–è€…åœ¨æ·±å±‚æ•°æ®ç»“æ„å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨ [`forceUpdate()`](https://zh-hans.reactjs.org/docs/react-component.html#forceupdate) æ¥ç¡®ä¿ç»„ä»¶è¢«æ­£ç¡®åœ°æ›´æ–°ã€‚ä½ ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ [immutable å¯¹è±¡](https://facebook.github.io/immutable-js/)åŠ é€ŸåµŒå¥—æ•°æ®çš„æ¯”è¾ƒã€‚

æ­¤å¤–ï¼Œ`React.PureComponent` ä¸­çš„ `shouldComponentUpdate()` å°†è·³è¿‡æ‰€æœ‰å­ç»„ä»¶æ ‘çš„ prop æ›´æ–°ã€‚å› æ­¤ï¼Œè¯·ç¡®ä¿æ‰€æœ‰å­ç»„ä»¶ä¹Ÿéƒ½æ˜¯â€œçº¯â€çš„ç»„ä»¶ã€‚

### 3.`React.memo`

> Reactç»„ä»¶ä¼šåœ¨ä¸¤ç§æƒ…å†µä¸‹å‘ç”Ÿæ¸²æŸ“ï¼š
>
> 1. å½“ç»„ä»¶è‡ªèº«stateå‘ç”Ÿå˜åŒ–æ—¶
> 2. å½“çˆ¶ç»„ä»¶å‘ç”Ÿé‡æ¸²æŸ“æ—¶ï¼ˆä½¿ç”¨`React.memo`ä¸»è¦é’ˆå¯¹å°±æ˜¯ä¼˜åŒ–è¿™ç‚¹ï¼‰

#### ä½¿ç”¨åœºæ™¯

> å¦‚æœä½ çš„ç»„ä»¶åœ¨ç›¸åŒ `props` çš„æƒ…å†µä¸‹æ¸²æŸ“ç›¸åŒçš„ç»“æœï¼Œé‚£ä¹ˆä½ å¯ä»¥é€šè¿‡å°†å…¶åŒ…è£…åœ¨ `React.memo` ä¸­è°ƒç”¨ï¼Œä»¥æ­¤ç¼“å­˜è¯¥ç»„ä»¶æ¥æé«˜ç»„ä»¶çš„æ€§èƒ½è¡¨ç°ã€‚å½“`props`å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé‡æ–°æ¸²æŸ“ï¼Œå¦åˆ™è¿”å›ä¹‹å‰çš„æ¸²æŸ“ç»“æœã€‚

è¿™æ„å‘³ç€åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒReact å°†è·³è¿‡æ¸²æŸ“ç»„ä»¶çš„æ“ä½œå¹¶ç›´æ¥å¤ç”¨æœ€è¿‘ä¸€æ¬¡æ¸²æŸ“çš„ç»“æœã€‚

```jsx
import React from 'react';

const MyComponent = function (props) {
  /* ä½¿ç”¨ props æ¸²æŸ“ */
}
export default React.memo(MyComponent);
```

#### ç‰¹ç‚¹

**`React.memo` ä»…æ£€æŸ¥ props å˜æ›´**ã€‚å¦‚æœå‡½æ•°ç»„ä»¶è¢« `React.memo` åŒ…è£¹ï¼Œä¸”å…¶å®ç°ä¸­æ‹¥æœ‰ [`useState`](https://zh-hans.reactjs.org/docs/hooks-state.html)ï¼Œ[`useReducer`](https://zh-hans.reactjs.org/docs/hooks-reference.html#usereducer) æˆ– [`useContext`](https://zh-hans.reactjs.org/docs/hooks-reference.html#usecontext) çš„ Hookï¼Œå½“ `state` æˆ– `context` å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒä»ä¼šé‡æ–°æ¸²æŸ“ã€‚

é»˜è®¤æƒ…å†µä¸‹`React.memo`åªä¼šå¯¹å¤æ‚å¯¹è±¡åšæµ…å±‚å¯¹æ¯”ï¼Œå¦‚æœä½ æƒ³è¦æ§åˆ¶å¯¹æ¯”è¿‡ç¨‹ï¼Œé‚£ä¹ˆè¯·å°†è‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥æ¥å®ç°ï¼ˆæ­¤æ–¹æ³•ä»…ä½œä¸º**æ€§èƒ½ä¼˜åŒ–**çš„æ–¹å¼è€Œå­˜åœ¨ã€‚ä½†è¯·ä¸è¦ä¾èµ–å®ƒæ¥â€œé˜»æ­¢â€æ¸²æŸ“ï¼Œå› ä¸ºè¿™ä¼šäº§ç”Ÿ **bug**ï¼‰ï¼š

```jsx
function MyComponent(props) {
  /* ä½¿ç”¨ props æ¸²æŸ“ */
}
function areEqual(prevProps, nextProps) {
  /*
  å¦‚æœæŠŠ nextProps ä¼ å…¥ render æ–¹æ³•çš„è¿”å›ç»“æœä¸
  å°† prevProps ä¼ å…¥ render æ–¹æ³•çš„è¿”å›ç»“æœä¸€è‡´åˆ™è¿”å› trueï¼Œ
  å¦åˆ™è¿”å› false
  */
}
export default React.memo(MyComponent, areEqual);
```

**æ³¨æ„ğŸ“¢**ï¼šä¸ class ç»„ä»¶ä¸­ [`shouldComponentUpdate()`](https://zh-hans.reactjs.org/docs/react-component.html#shouldcomponentupdate) æ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œå¦‚æœ props ç›¸ç­‰ï¼Œ`areEqual` ä¼šè¿”å› `true`ï¼›å¦‚æœ props ä¸ç›¸ç­‰ï¼Œåˆ™è¿”å› `false`ã€‚è¿™ä¸ `shouldComponentUpdate` æ–¹æ³•çš„è¿”å›å€¼ç›¸åã€‚

### 4.`React.Fragment` ç‰‡æ®µ

> React ä¸­çš„ä¸€ä¸ªå¸¸è§æ¨¡å¼æ˜¯ä¸€ä¸ªç»„ä»¶è¿”å›å¤šä¸ªå…ƒç´ (å› ä¸ºReactç»„ä»¶çš„å®šä¹‰åªèƒ½è¿”å›å•æ ¹å…ƒç´  )ã€‚`Fragments ` å…è®¸ä½ å°†å­åˆ—è¡¨åˆ†ç»„ï¼Œè€Œæ— éœ€å‘ DOM æ·»åŠ é¢å¤–èŠ‚ç‚¹ã€‚

```jsx
const App = () => {
  return (
    <React.Fragment>
      Some text.
      <h2>A heading</h2>
    </React.Fragment>
  );
}

// ç®€å†™æ–¹å¼
const App = () => {
  return (
    <>
      Some text.
      <h2>A heading</h2>
    </>
  );
}
```

`React.Fragment`ç»„ä»¶ç›¸å½“äºå¦‚ä¸‹ä»£ç ï¼š

```react
import React from 'react';

const Fragment = (props) => {
  return props.children;
}
export default Fragment;
```

ä½†æ˜¯ä½¿ç”¨ `<> </>`ï¼Œä¸æ”¯æŒ **key** æˆ– **å±æ€§**

#### å¸¦ key çš„ Fragments

> ä½¿ç”¨æ˜¾å¼ `<React.Fragment>` è¯­æ³•å£°æ˜çš„ç‰‡æ®µå¯èƒ½å…·æœ‰ `key`ã€‚ä¸€ä¸ªä½¿ç”¨åœºæ™¯æ˜¯å°†ä¸€ä¸ªé›†åˆæ˜ å°„åˆ°ä¸€ä¸ª Fragments æ•°ç»„ã€‚
>
> ä¸¾ä¸ªä¾‹å­ï¼Œåˆ›å»ºä¸€ä¸ªæè¿°åˆ—è¡¨ï¼š

```jsx
function Glossary(props) {
  return (
    <dl>
      {props.items.map(item => (
        // æ²¡æœ‰`key`ï¼ŒReact ä¼šå‘å‡ºä¸€ä¸ªå…³é”®è­¦å‘Š
        <React.Fragment key={item.id}>
          <dt>{item.term}</dt>
          <dd>{item.description}</dd>
        </React.Fragment>
      ))}
    </dl>
  );
}
```

`key` æ˜¯å”¯ä¸€å¯ä»¥ä¼ é€’ç»™ `Fragment` çš„å±æ€§ã€‚æœªæ¥æˆ‘ä»¬å¯èƒ½ä¼šæ·»åŠ å¯¹å…¶ä»–å±æ€§çš„æ”¯æŒï¼Œä¾‹å¦‚äº‹ä»¶ã€‚

## äºŒã€åˆ›å»º React å…ƒç´ 

æ¯ä¸ª JSX å…ƒç´ éƒ½æ˜¯è°ƒç”¨ [`React.createElement()`](https://zh-hans.reactjs.org/docs/react-api.html#createelement) çš„è¯­æ³•ç³–ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä½ ä½¿ç”¨äº† JSXï¼Œå°±ä¸å†éœ€è¦è°ƒç”¨ä»¥ä¸‹æ–¹æ³•ï¼š

- `createElement()`
- `createFactory()`

### 1. ` createElement()`

> æ ¼å¼ï¼š`React.createElement(type /* type å¿…é¡»æ˜¯å­—æ¯å°å†™çš„æ ‡ç­¾å */, [props], [...children])`

```react
const button = React.createElement('button', {
  id: 'btn',
  className: 'btn',
  onClick: () => { console.log('btn.'); } // äº‹ä»¶åé©¼å³°å½¢å¼
}, 'æŒ‰é’®');
const div = React.createElement('div', null, ['div:', button])
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(div)

// è€ç‰ˆæœ¬
// ReactDOM.render(div, document.getElementById('root'))
```

### 2. `createFactory()` - å·²åºŸå¼ƒ

> è¿”å›ç”¨äºç”ŸæˆæŒ‡å®šç±»å‹ React å…ƒç´ çš„å‡½æ•°ã€‚ä¸ [`React.createElement()`](https://zh-hans.reactjs.org/docs/react-api.html#createelement) ç›¸ä¼¼çš„æ˜¯ï¼Œç±»å‹å‚æ•°æ—¢å¯ä»¥æ˜¯æ ‡ç­¾åå­—ç¬¦ä¸²ï¼ˆåƒæ˜¯ `'div'` æˆ– `'span'`ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ [React ç»„ä»¶](https://zh-hans.reactjs.org/docs/components-and-props.html) ç±»å‹ ï¼ˆclass ç»„ä»¶æˆ–å‡½æ•°ç»„ä»¶ï¼‰ï¼Œæˆ–æ˜¯ [React fragment](https://zh-hans.reactjs.org/docs/react-api.html#reactfragment) ç±»å‹ã€‚

```jsx
React.createFactory(type)
```

## ä¸‰ã€è½¬æ¢å…ƒç´ 

`React` æä¾›äº†å‡ ä¸ªç”¨äºæ“ä½œå…ƒç´ çš„ APIï¼š

- `cloneElement()`
- `isValidElement()`
- `React.Children`

### 1.`cloneElement()`

```jsx
React.cloneElement(
  element,
  [config],
  [...children]
)
```

ä»¥ `element` å…ƒç´ ä¸ºæ ·æ¿å…‹éš†å¹¶è¿”å›æ–°çš„ React å…ƒç´ ã€‚`config` ä¸­åº”åŒ…å«æ–°çš„ propsï¼Œ`key` æˆ– `ref`ã€‚è¿”å›å…ƒç´ çš„ props æ˜¯å°†æ–°çš„ props ä¸åŸå§‹å…ƒç´ çš„ props æµ…å±‚åˆå¹¶åçš„ç»“æœã€‚

æ–°çš„å­å…ƒç´ å°†å–ä»£ç°æœ‰çš„å­å…ƒç´ ï¼Œå¦‚æœåœ¨ `config` ä¸­æœªå‡ºç° `key` æˆ– `ref`ï¼Œé‚£ä¹ˆåŸå§‹å…ƒç´ çš„ `key` å’Œ `ref` å°†è¢«ä¿ç•™ã€‚

`React.cloneElement()` å‡ ä¹ç­‰åŒäºï¼š

```jsx
<element.type {...element.props} {...props}>{children}</element.type>
```

ä½†æ˜¯ï¼Œè¿™ä¹Ÿä¿ç•™äº†ç»„ä»¶çš„ `ref`ã€‚è¿™æ„å‘³ç€å½“é€šè¿‡ `ref` è·å–å­èŠ‚ç‚¹æ—¶ï¼Œä½ å°†ä¸ä¼šæ„å¤–åœ°ä»ä½ ç¥–å…ˆèŠ‚ç‚¹ä¸Šçªƒå–å®ƒã€‚ç›¸åŒçš„ `ref` å°†æ·»åŠ åˆ°å…‹éš†åçš„æ–°å…ƒç´ ä¸­ã€‚å¦‚æœå­˜åœ¨æ–°çš„ `ref` æˆ– `key` å°†è¦†ç›–ä¹‹å‰çš„ã€‚

### 2`.isValidElement()`

> éªŒè¯å¯¹è±¡æ˜¯å¦ä¸º React å…ƒç´ ï¼Œè¿”å›å€¼ä¸º `true` æˆ– `false`

```jsx
React.isValidElement(object)
```

### 3.`React.Children`

> æä¾›äº†ç”¨äºå¤„ç† `this.props.children` ä¸é€æ˜æ•°æ®ç»“æ„çš„å®ç”¨æ–¹æ³•

#### React.Children.map

```jsx
React.Children.map(children, function[(thisArg)])
```

åœ¨ `children` é‡Œçš„æ¯ä¸ªç›´æ¥å­èŠ‚ç‚¹ä¸Šè°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶å°† `this` è®¾ç½®ä¸º `thisArg`ã€‚å¦‚æœå­èŠ‚ç‚¹ä¸º `null` æˆ–æ˜¯ `undefined`ï¼Œåˆ™æ­¤æ–¹æ³•å°†è¿”å› `null` æˆ–æ˜¯ `undefined`ï¼Œè€Œä¸ä¼šè¿”å›æ•°ç»„ã€‚

**æ³¨æ„ğŸ“¢**ï¼šå¦‚æœ `children` æ˜¯ä¸€ä¸ª `Fragment` å¯¹è±¡ï¼Œå®ƒå°†è¢«è§†ä¸ºå•ä¸€å­èŠ‚ç‚¹çš„æƒ…å†µå¤„ç†ï¼Œè€Œä¸ä¼šè¢«éå†ã€‚

#### React.Children.forEach

```jsx
React.Children.forEach(children, function[(thisArg)])
```

ä¸`React.Children.map`ç±»ä¼¼ï¼Œä½†å®ƒä¸ä¼šè¿”å›ä¸€ä¸ªæ•°ç»„

####  React.Children.count

```jsx
React.Children.count(children)
```

è¿”å› `children` ä¸­çš„ç»„ä»¶æ€»æ•°é‡ï¼Œç­‰åŒäºé€šè¿‡ `map` æˆ– `forEach` è°ƒç”¨å›è°ƒå‡½æ•°çš„æ¬¡æ•°

#### React.Children.only

```jsx
React.Children.only(children)
```

éªŒè¯ `children` æ˜¯å¦åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼ˆä¸€ä¸ª React å…ƒç´ ï¼‰ï¼Œå¦‚æœæœ‰åˆ™è¿”å›å®ƒï¼Œå¦åˆ™æ­¤æ–¹æ³•ä¼šæŠ›å‡ºé”™è¯¯ã€‚

**æ³¨æ„ğŸ“¢**ï¼š`React.Children.only()` ä¸æ¥å— `React.Children.map()`çš„è¿”å›å€¼ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªæ•°ç»„è€Œå¹¶ä¸æ˜¯ React å…ƒç´ ã€‚

#### React.Children.toArray

```jsx
React.Children.toArray(children)
```

å°† `children` è¿™ä¸ªå¤æ‚çš„æ•°æ®ç»“æ„ä»¥æ•°ç»„çš„æ–¹å¼æ‰å¹³å±•å¼€å¹¶è¿”å›ï¼Œå¹¶ä¸ºæ¯ä¸ªå­èŠ‚ç‚¹åˆ†é…ä¸€ä¸ª keyã€‚å½“ä½ æƒ³è¦åœ¨æ¸²æŸ“å‡½æ•°ä¸­æ“ä½œå­èŠ‚ç‚¹çš„é›†åˆæ—¶ï¼Œå®ƒä¼šéå¸¸å®ç”¨ï¼Œ**ç‰¹åˆ«æ˜¯å½“ä½ æƒ³è¦åœ¨å‘ä¸‹ä¼ é€’ `this.props.children` ä¹‹å‰å¯¹å†…å®¹é‡æ–°æ’åºæˆ–è·å–å­é›†æ—¶**ã€‚

**æ³¨æ„ğŸ“¢**ï¼š`React.Children.toArray()` åœ¨æ‹‰å¹³å±•å¼€å­èŠ‚ç‚¹åˆ—è¡¨æ—¶ï¼Œæ›´æ”¹ key å€¼ä»¥ä¿ç•™åµŒå¥—æ•°ç»„çš„è¯­ä¹‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`toArray` ä¼šä¸ºè¿”å›æ•°ç»„ä¸­çš„æ¯ä¸ª key æ·»åŠ å‰ç¼€ï¼Œä»¥ä½¿å¾—æ¯ä¸ªå…ƒç´  key çš„èŒƒå›´éƒ½é™å®šåœ¨æ­¤å‡½æ•°å…¥å‚æ•°ç»„çš„å¯¹è±¡å†…ã€‚

## å››ã€Refs

- `React.createRef`
- `React.forwardRef`

### 1.`React.createRef`

> `React.createRef` åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿé€šè¿‡ ref å±æ€§é™„åŠ åˆ° React å…ƒç´ çš„ [ref](https://zh-hans.reactjs.org/docs/refs-and-the-dom.html)ã€‚

```jsx
class MyComponent extends React.Component {
  constructor(props) {
    super(props);

    this.inputRef = React.createRef();
  }

  render() {
    return <input type="text" ref={this.inputRef} />;
  }

  componentDidMount() {
    this.inputRef.current.focus();
  }
}
```

### 2.`React.forwardRef`

`React.forwardRef` ä¼šåˆ›å»ºä¸€ä¸ªReactç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶èƒ½å¤Ÿå°†å…¶æ¥å—çš„ [ref](https://zh-hans.reactjs.org/docs/refs-and-the-dom.html) å±æ€§è½¬å‘åˆ°å…¶ç»„ä»¶æ ‘ä¸‹çš„å¦ä¸€ä¸ªç»„ä»¶ä¸­ã€‚å®ƒåœ¨ä»¥ä¸‹ä¸¤ç§åœºæ™¯ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼š

- [è½¬å‘ refs åˆ° DOM ç»„ä»¶](https://zh-hans.reactjs.org/docs/forwarding-refs.html#forwarding-refs-to-dom-components)
- [åœ¨é«˜é˜¶ç»„ä»¶ä¸­è½¬å‘ refs](https://zh-hans.reactjs.org/docs/forwarding-refs.html#forwarding-refs-in-higher-order-components)

`React.forwardRef` æ¥å—æ¸²æŸ“å‡½æ•°ä½œä¸ºå‚æ•°ã€‚React å°†ä½¿ç”¨ `props` å’Œ `ref` ä½œä¸ºå‚æ•°æ¥è°ƒç”¨æ­¤å‡½æ•°ã€‚æ­¤å‡½æ•°åº”è¿”å› React èŠ‚ç‚¹ã€‚

```jsx
const FancyButton = React.forwardRef((props, ref) => (  <button ref={ref} className="FancyButton">    {props.children}
  </button>
));

// You can now get a ref directly to the DOM button:
const ref = React.createRef();
<FancyButton ref={ref}>Click me!</FancyButton>;
```

åœ¨ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼ŒReact ä¼šå°† `<FancyButton ref={ref}>` å…ƒç´ çš„ `ref` ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™ `React.forwardRef` å‡½æ•°ä¸­çš„æ¸²æŸ“å‡½æ•°ã€‚è¯¥æ¸²æŸ“å‡½æ•°ä¼šå°† `ref` ä¼ é€’ç»™ `<button ref={ref}>` å…ƒç´ ã€‚

å› æ­¤ï¼Œå½“ React é™„åŠ äº† ref å±æ€§ä¹‹åï¼Œ`ref.current` å°†ç›´æ¥æŒ‡å‘ `<button>` DOM å…ƒç´ å®ä¾‹ã€‚

## äº”ã€Suspense

> Suspense ä½¿å¾—ç»„ä»¶å¯ä»¥â€œç­‰å¾…â€æŸäº›æ“ä½œç»“æŸåï¼Œå†è¿›è¡Œæ¸²æŸ“ã€‚ç›®å‰ï¼ŒSuspense ä»…æ”¯æŒçš„ä½¿ç”¨åœºæ™¯æ˜¯ï¼š[é€šè¿‡ `React.lazy` åŠ¨æ€åŠ è½½ç»„ä»¶](https://zh-hans.reactjs.org/docs/code-splitting.html#reactlazy)ã€‚å®ƒå°†åœ¨æœªæ¥æ”¯æŒå…¶å®ƒä½¿ç”¨åœºæ™¯ï¼Œå¦‚æ•°æ®è·å–ç­‰ã€‚

- `React.lazy`
- `React.Suspense`

### 1.`React.lazy`

> `React.lazy()` å…è®¸ä½ å®šä¹‰ä¸€ä¸ªåŠ¨æ€åŠ è½½çš„ç»„ä»¶ã€‚è¿™æœ‰åŠ©äºç¼©å‡ bundle çš„ä½“ç§¯ï¼Œå¹¶å»¶è¿ŸåŠ è½½åœ¨åˆæ¬¡æ¸²æŸ“æ—¶æœªç”¨åˆ°çš„ç»„ä»¶ã€‚

```jsx
// è¿™ä¸ªç»„ä»¶æ˜¯åŠ¨æ€åŠ è½½çš„
const SomeComponent = React.lazy(() => import('./SomeComponent'));
```

æ³¨æ„ğŸ“¢ï¼šæ¸²æŸ“ `lazy` ç»„ä»¶ä¾èµ–è¯¥ç»„ä»¶æ¸²æŸ“æ ‘ä¸Šå±‚çš„ `<React.Suspense>` ç»„ä»¶ã€‚

è¿™æ˜¯æŒ‡å®šåŠ è½½æŒ‡ç¤ºå™¨ï¼ˆloading indicatorï¼‰çš„æ–¹å¼ã€‚

### 2.`React.Suspense`

`React.Suspense` å¯ä»¥æŒ‡å®šåŠ è½½æŒ‡ç¤ºå™¨ï¼Œä»¥é˜²å…¶ç»„ä»¶æ ‘ä¸­çš„æŸäº›å­ç»„ä»¶å°šæœªå…·å¤‡æ¸²æŸ“æ¡ä»¶ã€‚

å¦‚ä»Šï¼Œæ‡’åŠ è½½ç»„ä»¶æ˜¯ `<React.Suspense>` æ”¯æŒçš„å”¯ä¸€ç”¨ä¾‹ï¼š

```jsx
// è¯¥ç»„ä»¶æ˜¯åŠ¨æ€åŠ è½½çš„
const OtherComponent = React.lazy(() => import('./OtherComponent'));

function MyComponent() {
  return (
    // æ˜¾ç¤º <Spinner> ç»„ä»¶ç›´è‡³ OtherComponent åŠ è½½å®Œæˆ
    <React.Suspense fallback={<Spinner />}>
      <div>
        <OtherComponent />
      </div>
    </React.Suspense>
  );
}
```

è¯·æ³¨æ„ï¼Œ`lazy` ç»„ä»¶å¯ä»¥ä½äº `Suspense` ç»„ä»¶æ ‘çš„æ·±å¤„â€”â€”å®ƒä¸å¿…åŒ…è£…æ ‘ä¸­çš„æ¯ä¸€ä¸ªå»¶è¿ŸåŠ è½½ç»„ä»¶ã€‚æœ€ä½³å®è·µæ˜¯å°† `<Suspense>` ç½®äºä½ æƒ³å±•ç¤ºåŠ è½½æŒ‡ç¤ºå™¨ï¼ˆloading indicatorï¼‰çš„ä½ç½®ï¼Œè€Œ `lazy()` åˆ™å¯è¢«æ”¾ç½®äºä»»ä½•ä½ æƒ³è¦åšä»£ç åˆ†å‰²çš„åœ°æ–¹ã€‚

> æ³¨æ„ğŸ“¢ï¼š
>
> å¯¹äºå·²ç»å±•ç¤ºç»™ç”¨æˆ·çš„å†…å®¹æ¥è¯´ï¼Œåœ¨åˆ‡æ¢å›å»æ—¶ï¼Œå±•ç¤ºåŠ è½½æŒ‡ç¤ºå™¨å¯èƒ½ä¼šè®©äººå›°æƒ‘ã€‚æœ‰æ—¶ï¼Œåœ¨å‡†å¤‡æ–°çš„ UI æ—¶ï¼Œå±•ç¤º â€œæ—§â€ çš„ UI å¯èƒ½ä¼šæ›´åŠ å‹å¥½ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥ä½¿ç”¨æ–°çš„ transition API [`startTransition`](https://zh-hans.reactjs.org/docs/react-api.html#starttransition) å’Œ [`useTransition`](https://zh-hans.reactjs.org/docs/hooks-reference.html#usetransition) æ¥å°†æ ‡è®°æ›´æ–°ä¸º transitionsï¼ŒåŒæ—¶é¿å…æ„å¤–çš„å…œåº•æ–¹æ¡ˆã€‚

#### æœåŠ¡ç«¯æ¸²æŸ“ä¸­çš„ `React.Suspense`

åœ¨æœåŠ¡ç«¯æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼ŒSuspense è¾¹ç•Œå…è®¸ä½ æŒ‚èµ·ï¼Œé€šè¿‡è¾ƒå°çš„å—æ¥åˆ·æ–°åº”ç”¨ç¨‹åºã€‚ å½“ç»„ä»¶æŒ‚èµ·æ—¶ï¼Œæˆ‘ä»¬ä¼šå®‰æ’ä¸€ä¸ªä½ä¼˜å…ˆçº§çš„ä»»åŠ¡æ¥æ¸²æŸ“æœ€è¿‘çš„ Suspense è¾¹ç•Œçš„ fallbackã€‚å¦‚æœç»„ä»¶åœ¨æˆ‘ä»¬åˆ·æ–° fallback ä¹‹å‰å–æ¶ˆæŒ‚èµ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼šå‘é€å®é™…å†…å®¹å¹¶ä¸¢å¼ƒ fallbackã€‚

#### hydrate è¿‡ç¨‹ä¸­çš„ `React.Suspense`

Suspense è¾¹ç•Œä¾èµ–äºå®ƒä»¬çš„çˆ¶è¾¹ç•Œï¼Œåœ¨å®ƒä»¬å¯ä»¥ hydrate å‰è¢« hydrateï¼Œä½†æ˜¯å®ƒä»¬å¯ä»¥ç‹¬ç«‹äºå…„å¼Ÿè¾¹ç•Œè¿›è¡Œ hydrateã€‚è¾¹ç•Œ hydrate å‰å‘ç”Ÿçš„äº‹ä»¶å°†å¯¼è‡´è¾¹ç•Œ hydrate çš„ä¼˜å…ˆçº§é«˜äºç›¸é‚»è¾¹ç•Œçš„ä¼˜å…ˆçº§ã€‚å…·ä½“è¯·å‚é˜…[è®¨è®º](https://github.com/reactwg/react-18/discussions/130)ã€‚

## å…­ã€Transitions

*`Transitions`* æ˜¯ä¸€ä¸ªå…¨æ–°çš„å¹¶å‘ç‰¹æ€§ã€‚å®ƒå…è®¸ä½ å°†**æ ‡è®°**æ›´æ–°ä½œä¸ºä¸€ä¸ª `transitions`ï¼Œè¿™ä¼šå‘Šè¯‰ React å®ƒä»¬å¯ä»¥è¢«**ä¸­æ–­æ‰§è¡Œ**ï¼Œå¹¶é¿å…å›åˆ°å·²ç»å¯è§å†…å®¹çš„ `Suspense` é™çº§æ–¹æ¡ˆã€‚

- `React.startTransition`
- `React.useTransition`

### 1.`React.startTransition`

```jsx
React.startTransition(callback)
```

`React.startTransition` è®©ä½ æŠŠæä¾›çš„ **fallback** é‡Œé¢çš„æ›´æ–°æ ‡è®°ä¸º **transitions**ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ä¸ºäº†åœ¨ [`React.useTransition`](https://zh-hans.reactjs.org/docs/hooks-reference.html#usetransition) ä¸å¯ç”¨æ—¶ä½¿ç”¨

> æ³¨æ„ğŸ“¢ï¼š
>
> è¿‡æ¸¡æœŸçš„æ›´æ–°ä¼šè¢«æ›´ç´§æ€¥çš„æ›´æ–°å–ä»£ï¼Œå¦‚ç‚¹å‡»æ“ä½œã€‚
>
> è¿‡æ¸¡æœŸçš„æ›´æ–°ä¸ä¼šæ˜¾ç¤ºé‡æ–°æŒ‚èµ·å†…å®¹çš„ **fallback**ï¼Œå…è®¸ç”¨æˆ·åœ¨æ¸²æŸ“æ›´æ–°æ—¶ç»§ç»­è¿›è¡Œäº¤äº’ã€‚
>
> `React.startTransition` ä¸æä¾› `isPending` çš„æ ‡å¿—ã€‚è¦è·Ÿè¸ªè¿‡æ¸¡çš„å¾…å®šçŠ¶æ€ï¼Œè¯·å‚é˜…`React.useTransition`

### 2.`React.useTransition`

```jsx
const [isPending, startTransition] = useTransition();
```

* `isPending`ï¼šä¸€ä¸ªçŠ¶æ€å€¼ï¼Œè¡¨ç¤ºè¿‡æ¸¡ä»»åŠ¡çš„ç­‰å¾…çŠ¶æ€

* `startTransition`ï¼šä¸€ä¸ªå¯åŠ¨è¯¥è¿‡æ¸¡ä»»åŠ¡çš„å‡½æ•°

`startTransition` å…è®¸ä½ é€šè¿‡æ ‡è®°æ›´æ–°å°†æä¾›çš„å›è°ƒå‡½æ•°ä½œä¸ºä¸€ä¸ªè¿‡æ¸¡ä»»åŠ¡ï¼š

```jsx
startTransition(() => {
  setCount(count + 1);
})
```

`isPending` æŒ‡ç¤ºè¿‡æ¸¡ä»»åŠ¡ä½•æ—¶æ´»è·ƒä»¥æ˜¾ç¤ºä¸€ä¸ªç­‰å¾…çŠ¶æ€ï¼š

```jsx
function App() {
  const [isPending, startTransition] = useTransition();
  const [count, setCount] = useState(0);
  
  function handleClick() {
    startTransition(() => {
      setCount(c => c + 1);
    })
  }

  return (
    <div>
      {isPending && <Spinner />}
      <button onClick={handleClick}>{count}</button>
    </div>
  );
}
```

> **æ³¨æ„ğŸ“¢**ï¼š
>
> è¿‡æ¸¡ä»»åŠ¡ä¸­è§¦å‘çš„æ›´æ–°ä¼šè®©æ›´ç´§æ€¥åœ°æ›´æ–°å…ˆè¿›è¡Œï¼Œæ¯”å¦‚ç‚¹å‡»ã€‚
>
> è¿‡æ¸¡ä»»åŠ¡ä¸­çš„æ›´æ–°å°†ä¸ä¼šå±•ç¤ºç”±äºå†æ¬¡æŒ‚èµ·è€Œå¯¼è‡´é™çº§çš„å†…å®¹ã€‚è¿™ä¸ªæœºåˆ¶å…è®¸ç”¨æˆ·åœ¨ React æ¸²æŸ“æ›´æ–°çš„æ—¶å€™ç»§ç»­ä¸å½“å‰å†…å®¹è¿›è¡Œäº¤äº’ã€‚
