## ç»„åˆæ¨¡å¼

> ç»„åˆæ¨¡å¼æ˜¯ä¸€ç§ä¸“é—¨ä¸ºåˆ›å»ºWebä¸Šçš„åŠ¨æ€ç”¨æˆ·ç•Œé¢è€Œé‡èº«å®šåˆ¶çš„æ¨¡å¼ï¼Œ**ä½¿ç”¨è¿™ç§æ¨¡å¼å¯ä»¥ç”¨ä¸€æ¡å‘½ä»¤åœ¨å¤šä¸ªå¯¹è±¡ä¸Šæ¿€å‘å¤æ‚çš„æˆ–é€’å½’çš„è¡Œä¸º**ã€‚è¿™å¯ä»¥ç®€åŒ–ç²˜åˆæ€§ä»£ç ï¼Œä½¿å…¶æ›´å®¹æ˜“ç»´æŠ¤ï¼Œè€Œé‚£äº›å¤æ‚è¡Œä¸ºåˆ™è¢«å§”æ‰˜ç»™å„ä¸ªå¯¹è±¡ã€‚

**ç»„åˆæ¨¡å¼çš„å¥½å¤„ï¼š**

1. å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•å¤„ç†å¯¹è±¡çš„é›†åˆä¸å…¶ä¸­çš„ç‰¹å®šå­å¯¹è±¡
2. å¯ä»¥ç”¨æ¥æŠŠä¸€æ‰¹å­å¯¹è±¡ç»„ç»‡æˆæ ‘å½¢ç»“æ„ï¼Œå¹¶ä¸”ä½¿æ•´æ£µæ ‘éƒ½å¯ä»¥è¢«éå†

```js
 /*
 * åœºæ™¯æ¨¡æ‹Ÿï¼š
 *  -> å…¬å¸ 
 *			-> è´¢åŠ¡éƒ¨é—¨
 *						-> å¼ ä¸€
 *						-> å¼ äºŒ
 *						-> å¼ ä¸‰
 *			-> é”€å”®éƒ¨é—¨
 *						-> å¼ å››
 *						-> å¼ äº”
 *						-> å¼ å…­
 *	
 *		å®é™…çš„ä»»åŠ¡å…·ä½“æ˜¯è½å®åˆ°äººä¸Šå»å®æ–½çš„ ä¹Ÿå°±æ˜¯è¯´åªæœ‰äººæ‰å…·æœ‰å…·ä½“çš„æ–¹æ³•å®ç°
 *			
 */	
const Org = function(name) {
  this.name = name;
  this.depts = [];
}
Org.prototype = {
  constructor: Org,
  addDepts: function(child) {
    this.depts.push(child);
    return this; // é“¾å¼è°ƒç”¨
  },
  getDepts: function(){
    return this.depts;
  }
}

const Dept = function(name) {
  this.name = name;
  this.persons = [];
}
Dept.prototype = {
  constructor: Dept,
  addPersons: function(child) {
    this.persons.push(child);
    return this; // é“¾å¼è°ƒç”¨
  },
  getPersons: function(){
    return this.persons;
  }
}

const Person = function(name) {
  this.name = name;
  
}
Person.prototype = {
  constructor: Person,
  hardworking: function() {
    document.write(this.name + '...åŠªåŠ›å·¥ä½œ!');
  },
  sleeping: function() {
    document.write(this.name + '...åŠªåŠ›ç¡è§‰!');
  }
}

const p1 = new Person('å¼ 1');
const p2 = new Person('å¼ 2');
const p3 = new Person('å¼ 3');
const p4 = new Person('å¼ 4');
const p5 = new Person('å¼ 5');
const p6 = new Person('å¼ 6');

const dept1 = new Dept('å¼€å‘éƒ¨é—¨');
dept1.addPersons(p1).addPersons(p2).addPersons(p3);
const dept2 = new Dept('é”€å”®éƒ¨é—¨');
dept2.addPersons(p4).addPersons(p5).addPersons(p6);

const org = new Org('bjsxt');
org.addDepts(dept1).addDepts(dept2);

// éœ€æ±‚ï¼š å…·ä½“çš„è®©ä¸€ä¸ªäººï¼ˆå¼ 3ï¼‰å»åŠªåŠ›å·¥ä½œ
for(let i = 0 ,depts = org.getDepts(); i<depts.length;i++ ){
  for(let j = 0 ,persons = depts[i].getPersons(); j < persons.length ; j++){
    if(persons[j].name === 'å¼ 6'){
      persons[j].hardworking();
    }
  }
}
```

**ä½¿ç”¨ç»„åˆæ¨¡å¼**

```js
/**
 *  ç»„åˆæ¨¡å¼åº”ç”¨çš„åœºæ™¯å’Œç‰¹ç‚¹ï¼š
 *  åœºæ™¯ï¼š
 *  1.å­˜åœ¨ä¸€æ‰¹ç»„ç»‡æˆæŸç§å±‚æ¬¡ä½“ç³»çš„å¯¹è±¡
 *  2.å¸Œæœ›å¯¹è¿™æ‰¹å¯¹è±¡æˆ–å…¶ä¸­çš„ä¸€éƒ¨åˆ†å¯¹è±¡å®æ–½ä¸€ä¸ªæ“ä½œ
 *  
 *  åº”ç”¨ç‰¹ç‚¹ï¼š
 *  1.ç»„åˆæ¨¡å¼ä¸­åªæœ‰ä¸¤ç§ç±»å‹å¯¹è±¡ï¼šç»„åˆå¯¹è±¡ã€å¶å­å¯¹è±¡
 *	2.è¿™ä¸¤ç§ç±»å‹éƒ½å®ç°åŒä¸€æ‰¹æ¥å£
 *	3.ä¸€èˆ¬æˆ‘ä»¬ä¼šåœ¨ç»„åˆå¯¹è±¡ä¸­è°ƒç”¨å…¶æ–¹æ³•å¹¶éšå¼è°ƒç”¨"ä¸‹çº§å¯¹è±¡"çš„æ–¹æ³•ï¼ˆè¿™é‡Œæˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨é€’å½’çš„å½¢å¼å»åšï¼‰
 * 
 */

/*
 * åœºæ™¯æ¨¡æ‹Ÿï¼š
 *  -> å…¬å¸ 
 *  	 -> åŒ—äº¬åˆ†å…¬å¸
 *					-> è´¢åŠ¡éƒ¨é—¨
 *								-> å¼ 1
 *								-> å¼ 2
 *								-> å¼ 3
 *					-> é”€å”®éƒ¨é—¨
 *								-> å¼ 4
 *								-> å¼ 5
 *								-> å¼ 6
 *		 -> é•¿æ²™åˆ†å…¬å¸ 
 *					-> è´¢åŠ¡éƒ¨é—¨
 *								-> å¼ 7
 *								-> å¼ 8
 *								-> å¼ 9
 *					-> é”€å”®éƒ¨é—¨
 *								-> å¼ 10
 *								-> å¼ 11
 *								-> å¼ 12					 
 *	
 *		å®é™…çš„ä»»åŠ¡å…·ä½“æ˜¯è½å®åˆ°äººä¸Šå»å®æ–½çš„ ä¹Ÿå°±æ˜¯è¯´åªæœ‰äººæ‰å…·æœ‰å…·ä½“çš„æ–¹æ³•å®ç°
 *			
 */	

const CompositeInterface = new BH.Interface('CompositeInterface' , ['addChild','getChild']);
const LeafInterface = new BH.Interface('LeafInterface' , ['hardworking','sleeping']);

const Composite = function(name) {
  this.name = name;
  this.type = 'Composite'; // è¯´æ˜å¯¹è±¡çš„ç±»å‹ï¼ˆç»„åˆå¯¹è±¡ï¼‰
  this.children = [];
};
Composite.prototype = {
  constructor: Composite,
  addChild: function(child) {
    this.children.push(child);
    return this;
  },
  getChild: function(name) {
    // æ¥å—å¶å­å¯¹è±¡ç±»å‹çš„æ•°ç»„
    const elements = [] ;

    // åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºLeafç±»å‹çš„,å¦‚æœæ˜¯,ç›´æ¥åŠ åˆ°elementsæ•°ç»„ä¸­;ä¸æ˜¯,ç»§ç»­é€’å½’è°ƒç”¨
    const pushLeaf = function(item){
      if(item.type === 'Composite'){
        item.children.each(arguments.callee);
      } else if(item.type === 'Leaf'){
        elements.push(item);
      }
    };


    // æ ¹æ®name è®©æŒ‡å®šnameä¸‹çš„æ‰€æœ‰çš„ç±»å‹ä¸ºLeafçš„å¯¹è±¡å»æ‰§è¡Œæ“ä½œ
    if(name && this.name !== name){ 
      this.children.each(function(item){
        // å¦‚æœä¼ é€’çš„nameæ˜¯2çº§èŠ‚ç‚¹åç§°
        if(item.name === name && item.type === 'Composite'){
          item.children.each(pushLeaf);
        }
        // å¦‚æœä¼ é€’çš„nameæ˜¯3çº§èŠ‚ã€4çº§ã€5çº§...Nçº§ 
        if(item.name !== name && item.type === 'Composite'){
          item.children.each(arguments.callee);
        }
        // å¦‚æœä¼ é€’çš„nameæ˜¯å¶å­èŠ‚ç‚¹çš„æ—¶å€™
        if(item.name === name && item.type === 'Leaf'){
          elements.push(item);
        }
      });
    } 
    // ä¸ä¼ é€’name è®©æ•´ä¸ªå…¬å¸æ‰€æœ‰ç±»å‹ä¸ºLeafçš„å¯¹è±¡å»æ‰§è¡Œæ“ä½œ
    else {  
      this.children.each(pushLeaf);
    }

    return elements ;
  },
  hardworking: function(name) {
    //å¾—åˆ°æ‰€æœ‰çš„Leafç±»å‹çš„å¯¹è±¡æ•°ç»„
    const leafObjects = this.getChild(name);
    for(let i = 0 ; i < leafObjects.length; i ++){
      leafObjects[i].hardworking();
    }
  },
  sleeping: function(name) {
    //å¾—åˆ°æ‰€æœ‰çš„Leafç±»å‹çš„å¯¹è±¡æ•°ç»„
    const leafObjects = this.getChild(name);
    for(let i = 0 ; i < leafObjects.length; i ++){
      leafObjects[i].sleeping();
    }
  }
}

const Leaf = function(name) {
  this.name = name;
  this.type = "leaf"; // è¯´æ˜å¯¹è±¡çš„ç±»å‹ï¼ˆğŸƒå¶å­å¯¹è±¡ï¼‰
}
Leaf.prototype = {
  constructor: Leaf,
  addChild: function(child) {
    throw new Error('this method is disabled....');
  },
  getChild: function(name) {
    if(this.name == name){
      return this; 
    }
    return null;
  },
  hardworking: function() {
    document.write(this.name + '...åŠªåŠ›å·¥ä½œ!');
  },
  sleeping: function() {
    document.write(this.name + '...åŠªåŠ›ç¡è§‰!');
  }
}

//æµ‹è¯•æ•°æ®
const p1 = new Leaf('å¼ 1');
const p2 = new Leaf('å¼ 2');
const p3 = new Leaf('å¼ 3');
const p4 = new Leaf('å¼ 4');
const p5 = new Leaf('å¼ 5');
const p6 = new Leaf('å¼ 6');
const p7 = new Leaf('å¼ 7');
const p8 = new Leaf('å¼ 8');
const p9 = new Leaf('å¼ 9');
const p10 = new Leaf('å¼ 10');
const p11 = new Leaf('å¼ 11');
const p12 = new Leaf('å¼ 12');			 
const dept1 = new Composite('åŒ—äº¬å¼€å‘éƒ¨é—¨');
dept1.addChild(p1).addChild(p2).addChild(p3);
const dept2 = new Composite('åŒ—äº¬é”€å”®éƒ¨é—¨');
dept2.addChild(p4).addChild(p5).addChild(p6);
const dept3 = new Composite('é•¿æ²™å¼€å‘éƒ¨é—¨');
dept3.addChild(p7).addChild(p8).addChild(p9);
const dept4 = new Composite('é•¿æ²™é”€å”®éƒ¨é—¨');
dept4.addChild(p10).addChild(p11).addChild(p12);			 
const org1 = new Composite('åŒ—äº¬åˆ†å…¬å¸');
org1.addChild(dept1).addChild(dept2);	
const org2 = new Composite('é•¿æ²™åˆ†å…¬å¸');
org2.addChild(dept3).addChild(dept4);	

const org = new Composite('å°šå­¦å ‚æ€»éƒ¨');
org.addChild(org1).addChild(org2);


// è®©æ•´ä¸ªå…¬å¸ä¸‹æ‰€æœ‰çš„å‘˜å·¥éƒ½å»åŠªåŠ›å·¥ä½œ
org.hardworking();	 //å°šå­¦å ‚æ€»éƒ¨
document.write('<Br>----------------------------------<Br>');
// nameä¸ºæ€»å…¬å¸çš„ç›´æ¥å­èŠ‚ç‚¹çš„æ—¶å€™
org.hardworking('é•¿æ²™åˆ†å…¬å¸');
document.write('<Br>----------------------------------<Br>');
// nameä¸ºæ€»å…¬å¸çš„é—´æ¥å­èŠ‚ç‚¹çš„æ—¶å€™ï¼ˆç±»å‹ä¸ä¸ºleafï¼‰(3çº§4çº§...Nçº§)
org.hardworking('é•¿æ²™å¼€å‘éƒ¨é—¨');
document.write('<Br>----------------------------------<Br>');	
// nameä¸ºleafå¯¹è±¡çš„æ—¶å€™
org.hardworking('å¼ 5');
document.write('<Br>----------------------------------<Br>');			
```

```js
/**
 * æ‰©å±•Arrayçš„åŸå‹å¯¹è±¡ æ·»åŠ å˜é‡æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ ,å¹¶è®©æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ‰§è¡Œfnå‡½æ•° (å¯å˜é‡å¤šç»´æ•°ç»„)
 * @param {Object} fn
 */
Array.prototype.each = function(fn){
	try{
		//1 ç›®çš„ï¼š éå†æ•°ç»„çš„æ¯ä¸€é¡¹ //è®¡æ•°å™¨ è®°å½•å½“å‰éå†çš„å…ƒç´ ä½ç½®
		this.i || (this.i=0);  //var i = 0 ;
		//2 ä¸¥è°¨çš„åˆ¤æ–­ä»€ä¹ˆæ—¶å€™å»èµ°eachæ ¸å¿ƒæ–¹æ³•
		// å½“æ•°ç»„çš„é•¿åº¦å¤§äº0çš„æ—¶å€™ && ä¼ é€’çš„å‚æ•°å¿…é¡»ä¸ºå‡½æ•°
		if(this.length >0 && fn.constructor == Function){
			// å¾ªç¯éå†æ•°ç»„çš„æ¯ä¸€é¡¹
			while(this.i < this.length){	//whileå¾ªç¯çš„èŒƒå›´ 
				//è·å–æ•°ç»„çš„æ¯ä¸€é¡¹
				var e = this[this.i];
				//å¦‚æœå½“å‰å…ƒç´ è·å–åˆ°äº† å¹¶ä¸”å½“å‰å…ƒç´ æ˜¯ä¸€ä¸ªæ•°ç»„
				if(e && e.constructor == Array){
					// ç›´æ¥åšé€’å½’æ“ä½œ
					e.each(fn);
				} else {
					//å¦‚æœä¸æ˜¯æ•°ç»„ ï¼ˆé‚£å°±æ˜¯ä¸€ä¸ªå•ä¸ªå…ƒç´ ï¼‰
					// è¿™çš„ç›®çš„å°±æ˜¯ä¸ºäº†æŠŠæ•°ç»„çš„å½“å‰å…ƒç´ ä¼ é€’ç»™fnå‡½æ•° å¹¶è®©å‡½æ•°æ‰§è¡Œ
					//fn.apply(e,[e]);
					fn.call(e,e);
				}
				this.i++ ;
			}
			this.i = null ; // é‡Šæ”¾å†…å­˜ åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶å˜é‡
		}
		
	} catch(ex){
		// do something 
	}
	return this ;
}
```

