## äº«å…ƒæ¨¡å¼

> äº«å…ƒæ¨¡å¼æ˜¯ä¸€ç§ä¼˜åŒ–æ¨¡å¼ã€‚å®ƒæœ€é€‚åˆè§£å†³å› åˆ›å»ºå¤§é‡ç±»ä¼¼å¯¹è±¡è€Œç´¯åŠæ€§èƒ½çš„é—®é¢˜ã€‚è¿™ç§æ¨¡å¼åœ¨JavaScriptä¸­å°¤å…¶æœ‰ç”¨ï¼Œå› ä¸ºå¤æ‚çš„JavaScriptä»£ç å¯èƒ½å¾ˆå¿«å°±ä¼šç”¨å…‰æµè§ˆå™¨çš„æ‰€æœ‰å¯ç”¨å†…å­˜ã€‚é€šè¿‡æŠŠå¤§é‡ç‹¬ç«‹å¯¹è±¡è½¬åŒ–ä¸ºå°‘é‡å…±äº«å¯¹è±¡ï¼Œå¯é™ä½è¿è¡Œwebåº”ç”¨ç¨‹åºæ‰€éœ€çš„èµ„æºæ•°é‡

> äº«å…ƒæ¨¡å¼ï¼šä¼˜åŒ–çš„è®¾è®¡æ¨¡å¼ï¼ŒåŒ…æ‹¬ä¸¤æ–¹é¢ï¼š1. **æ—¶é—´ä¸Š(ä»£ç çš„è¿è¡Œæ—¶é—´)**ï¼Œ2. **ç©ºé—´ä¸Šï¼ˆwebæµè§ˆå™¨å†…å­˜ï¼‰**

### ç®€å•ç¤ºä¾‹

```js
// å‡ºå‚å•†ã€å‹å·ã€å‡ºå‚æ—¥æœŸã€æ‹¥æœ‰è€…ã€è½¦ç‰Œå·ã€æœ€è¿‘ç™»è®°æ—¥æœŸ
const Car = function(make ,model , year , owner , tag , renewDate ){
  this.make = make ; 
  this.model = model ; 
  this.year = year ; 
  this.owner = owner ; 
  this.tag = tag ;
  this.renewDate = renewDate;
};
Car.prototype = {
  constructor:Car  , 
  getMake :function(){
    return this.make;
  },
  getModel:function(){
    return this.model;
  },
  getYear:function(){
    return this.year;
  },
  renewRegistration:function(newRenewDate){
    this.renewDate = newRenewDate;
  }
};

var arr = [] ;
				
var stime = new Date().getTime();
for(var i = 0 ; i < 5000000; i ++){
  // runtime: 734ms  web: 570
  arr.push(new Car('ä¸Šæµ·å¤§ä¼—','è¿ˆè…¾','2012-02-03','bhx','bj0011','2013-04-01'));
}
var etime = new Date().getTime();
alert(etime - stime);

```

#### **ä½¿ç”¨äº«å…ƒæ¨¡å¼ä¼˜åŒ–å†…å­˜**

```js
/**
 * äº«å…ƒæ¨¡å¼ï¼šå†…åœ¨æ•°æ®static (å‡ºå‚å•†ã€å‹å·ã€å‡ºå‚æ—¥æœŸ)ï¼Œå¤–åœ¨æ•°æ®(æ‹¥æœ‰è€…ã€è½¦ç‰Œå·ã€æœ€è¿‘ç™»è®°æ—¥æœŸ)
 */

//å‡ºå‚å•†ã€å‹å·ã€å‡ºå‚æ—¥æœŸã€æ‹¥æœ‰è€…ã€è½¦ç‰Œå·ã€æœ€è¿‘ç™»è®°æ—¥æœŸ
var Car = function(make ,model , year){
  this.make = make ; 
  this.model = model ; 
  this.year = year ; 
};
Car.prototype = {
  constructor:Car  , 
  getMake :function(){
    return this.make;
  },
  getModel:function(){
    return this.model;
  },
  getYear:function(){
    return this.year;
  }
};

//å·¥å‚æ¨¡å¼ï¼ˆé—­åŒ…å·¥å‚ï¼‰
var CarFactory = (function(){
  //ç”¨äºæ‰¿è£…å·²ç»ç”Ÿäº§å¥½çš„car 
  var createdCars = {} ;
  return {
    createCar: function(make ,model , year ){
      //å¦‚æœcreatedCarså¯¹è±¡é‡Œå·²ç»å­˜åœ¨å½“å‰çš„make ,model , year
      if(createdCars[make+model+year]){
        return createdCars[make+model+year];
      } else {
        var car = new Car(make ,model , year);
        createdCars[make+model+year] = car ;
        return car ;
      }
    }
  };
})();

// å•ä¾‹æ¨¡å¼ï¼ˆå¤–åœ¨æ•°æ® å’Œ å†…åœ¨æ•°æ® ç»“åˆåœ¨ä¸€èµ·ï¼‰
const CarRecordManager = (function(){
  // æŠŠç™»è®°å¥½çš„æ±½è½¦æ”¾åœ¨è¿™ä¸ªå¯¹è±¡é‡Œ
  const = carRecordDataBase = {};
  return {
    addCarRecord: function(make ,model , year , owner , tag , renewDate) {
      const car = CarFactory.createCar(make ,model , year);
      carRecordDataBase[tag] = {
        owner : owner , 
        renewDate : renewDate ,
        car : car 
      };
    },
    renewRegistration:function(tag , newRenewDate){
      carRecordDataBase[tag].renewDate = newRenewDate;
    }	
  }
})();

const arr = [] ;
const stime = new Date().getTime();
for(var i = 0 ; i < 5000000; i ++){
  // runtime: 734ms  web: 570
  // arr.push(new Car('ä¸Šæµ·å¤§ä¼—','è¿ˆè…¾','2012-02-03','bhx','bj0011','2013-04-01'));
  //äº«å…ƒæ¨¡å¼çš„æµ‹è¯•
  // runtime: 15m(3m - 5m)  web: 230
  arr.push(CarRecordManager.addCarRecord('ä¸Šæµ·å¤§ä¼—','è¿ˆè…¾','2012-02-03','bhx','bj0011','2013-04-01'));
}
const etime = new Date().getTime();
alert(etime - stime);
```

### æ¨¡æ‹Ÿwebæ—¥å†ğŸ“…

```js
//äº«å…ƒæ¨¡å¼ï¼šä¼˜åŒ–çš„è®¾è®¡æ¨¡å¼  webæ—¥å†(.........)
// å¹´å¯¹è±¡ã€æœˆä»½å¯¹è±¡ã€å¤©å¯¹è±¡
var CalendarInterface = new BH.Interface('CalendarInterface' , ['display']);

var CalendarYear = function(year , parent){
  this.year = year ; 
  this.element = document.createElement('div');
  this.element.style = 'none';
  parent.appendChild(this.element);

  // åˆ¤æ–­æ˜¯å¦æ˜¯é—°å¹´
  var isLeapYear = function(y){
    return (y>0) && !(y%4) && ((y%100)||!(y%400));
  };
  this.months = [] ; // å¹´å¯¹è±¡é‡Œåº”è¯¥åŒ…å«æœˆä»½
  //æ‰¿è£…å½“å‰å¹´æ‰€æœ‰æœˆä»½åˆ°åº•éƒ½æ˜¯å¤šå°‘å¤©
  this.numDays = [31,isLeapYear(this.year)?29:28,31,30,31,30,31,31,30,31,30,31];
  for(var i = 0 ; i<12;i++){
    this.months[i] = new CalendarMonth(i ,this.numDays[i] ,this.element);
  }
};
CalendarYear.prototype = {
  constructor:CalendarYear ,
  display:function(){
    for(var i = 0 ; i < this.months.length;i++){
      this.months[i].display();
    }
    //æ˜¾ç¤ºå‡ºæ¥æœˆä»½
    this.element.style.display = 'block';
  }
};


var CalendarMonth = function(monthNum , numDays ,parent){
  this.monthNum = monthNum ;
  this.element = document.createElement('div');
  this.element.style = 'none';
  parent.appendChild(this.element);
  this.days = [] ; // æœˆä»½é‡Œåº”è¯¥åŒ…å«ä¸€ä¸ªå¤©çš„æ•°ç»„
  for(var i = 0 ; i < numDays ; i++){
    this.days[i] = new CalendarDay(i+1 ,this.element );
  }
};
CalendarMonth.prototype = {
  constructor : CalendarMonth , 
  display:function(){
    for(var i = 0 ; i < this.days.length;i++){
      this.days[i].display();
    }
    //æ˜¾ç¤ºå‡ºæ¥å¤©
    this.element.style.display = 'block';
  }					
};

var CalendarDay = function(date , parent){
  this.date = date ; 
  this.element = document.createElement('div');
  this.element.style = 'none';
  parent.appendChild(this.element);					
};
CalendarDay.prototype = {
  constructor :CalendarDay , 
  display:function(){
    this.element.style.display = 'inline-block'; // è®©ä»–åˆ«ç»™æˆ‘æ¢è¡Œ
    this.element.innerHTML = this.date ;
  }
};


window.onload = function(){
  var mydiv = document.getElementById('mydiv');
  var myyear1 = new CalendarYear(2016 , mydiv);
  //365ä¸ªå¤©å¯¹è±¡
  myyear1.display();

}
```

#### **ä½¿ç”¨äº«å…ƒæ¨¡å¼ä¼˜åŒ–å†…å­˜**

```js
//äº«å…ƒæ¨¡å¼ï¼šä¼˜åŒ–çš„è®¾è®¡æ¨¡å¼  webæ—¥å†(.........)
// å¹´å¯¹è±¡ã€æœˆä»½å¯¹è±¡ã€å¤©å¯¹è±¡
var CalendarInterface = new BH.Interface('CalendarInterface' , ['display']);

var CalendarYear = function(year , parent){
  this.year = year ; 
  this.element = document.createElement('div');
  this.element.style = 'none';
  parent.appendChild(this.element);

  // åˆ¤æ–­æ˜¯å¦æ˜¯é—°å¹´
  var isLeapYear = function(y){
    return (y>0) && !(y%4) && ((y%100)||!(y%400));
  };
  this.months = [] ; // å¹´å¯¹è±¡é‡Œåº”è¯¥åŒ…å«æœˆä»½
  //æ‰¿è£…å½“å‰å¹´æ‰€æœ‰æœˆä»½åˆ°åº•éƒ½æ˜¯å¤šå°‘å¤©
  this.numDays = [31,isLeapYear(this.year)?29:28,31,30,31,30,31,31,30,31,30,31];
  for(var i = 0 ; i<12;i++){
    this.months[i] = new CalendarMonth(i ,this.numDays[i] ,this.element);
  }
};
CalendarYear.prototype = {
  constructor:CalendarYear ,
  display:function(){
    for(var i = 0 ; i < this.months.length;i++){
      this.months[i].display();
    }
    //æ˜¾ç¤ºå‡ºæ¥æœˆä»½
    this.element.style.display = 'block';
  }
};


var CalendarMonth = function(monthNum , numDays ,parent){
  this.monthNum = monthNum ;
  this.element = document.createElement('div');
  this.element.style = 'none';
  parent.appendChild(this.element);
  this.days = [] ; // æœˆä»½é‡Œåº”è¯¥åŒ…å«ä¸€ä¸ªå¤©çš„æ•°ç»„
  for(var i = 0 ; i < numDays ; i++){
    this.days[i] = calendarDaySingleIntance;
  }
};
CalendarMonth.prototype = {
  constructor : CalendarMonth , 
  display:function(){
    for(var i = 0 ; i < this.days.length;i++){
      this.days[i].display(i+1 ,this.element);
    }
    //æ˜¾ç¤ºå‡ºæ¥å¤©
    this.element.style.display = 'block';
  }					
};

var CalendarDay = function(){}; // ç©ºçš„å¤©å¯¹è±¡æ¨¡æ¿
CalendarDay.prototype = {
  constructor :CalendarDay , 
  display:function(date , parent){
    var element = document.createElement('div');
    parent.appendChild(element);						
    element.style.display = 'inline-block'; // è®©ä»–åˆ«ç»™æˆ‘æ¢è¡Œ
    element.innerHTML = date ;
  }
};

//å•ä¾‹å¯¹è±¡
var calendarDaySingleIntance = new CalendarDay();


window.onload = function(){
  var mydiv = document.getElementById('mydiv');
  var myyear1 = new CalendarYear(2012 , mydiv);
  //1ä¸ªå¹´å¯¹è±¡ 12ä¸ªæœˆå¯¹è±¡ 1ä¸ªå¤©å¯¹è±¡
  myyear1.display();
}
```

